<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Countydown</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üü°</text></svg>">
<style>
  :root{
    --bg:#000016; --maze:#0a1a4f; --grid:#0b0f2a; --text:#e6f3ff; --muted:#7aa0ff;
    --accent:#ffeb00; --accent-2:#00e5ff; --tile:#111b4a;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; background:
      linear-gradient(var(--grid) 1px, transparent 1px) 0 0/24px 24px,
      linear-gradient(90deg, var(--grid) 1px, transparent 1px) 0 0/24px 24px,
      var(--bg);
    color:var(--text);
    font-family:"Press Start 2P", system-ui, -apple-system, Segoe UI, Roboto, Arial, monospace;
    display:grid; place-items:center; padding:16px; -webkit-tap-highlight-color:transparent;
    image-rendering: pixelated;
    overflow-x:hidden;
  }
  .wrap{width:min(980px,96vw); display:flex; flex-direction:column; gap:14px; align-items:center; text-align:center; position:relative}

  /* floating tiny sprites (decorative) */
  .sprite{
    position:absolute; width:18px; height:16px;
    transform: translate(-50%, -50%);
    image-rendering: pixelated;
    filter: drop-shadow(0 0 6px rgba(255,235,0,.25));
    pointer-events:none; z-index:0;
  }
  /* build pixel Pompompurin-like dog with CSS box-shadow pixels */
  .sprite .pix{
    width:2px; height:2px; background:transparent; position:relative;
  }
  /* colors */
  .y{ background:#f6de5a }      /* golden body */
  .b{ background:#6a4a2c }      /* brown (beret/ears/eyes) */
  .p{ background:#ffcc66 }      /* lighter belly */
  .n{ background:transparent }

  /* We ‚Äúdraw‚Äù using box-shadows from a 2px seed to place pixels on a grid */
  .body{ width:2px; height:2px }
  /* Generated by hand: 18x16 grid (x,y offsets in multiples of 2px) */
  .body.y{ box-shadow:
    /* row 4-6 ears & head outline */
    10px 6px #f6de5a, 12px 6px #f6de5a, 14px 6px #f6de5a,
    8px 8px #f6de5a, 10px 8px #f6de5a, 12px 8px #f6de5a, 14px 8px #f6de5a, 16px 8px #f6de5a,
    6px 10px #f6de5a, 8px 10px #f6de5a, 10px 10px #f6de5a, 12px 10px #f6de5a, 14px 10px #f6de5a, 16px 10px #f6de5a, 18px 10px #f6de5a,
    /* face */
    6px 12px #f6de5a, 8px 12px #f6de5a, 10px 12px #f6de5a, 12px 12px #f6de5a, 14px 12px #f6de5a, 16px 12px #f6de5a, 18px 12px #f6de5a,
    6px 14px #f6de5a, 8px 14px #f6de5a, 10px 14px #f6de5a, 12px 14px #f6de5a, 14px 14px #f6de5a, 16px 14px #f6de5a, 18px 14px #f6de5a,
    /* cheeks */
    4px 16px #f6de5a, 6px 16px #f6de5a, 8px 16px #f6de5a, 10px 16px #f6de5a, 12px 16px #f6de5a, 14px 16px #f6de5a, 16px 16px #f6de5a, 18px 16px #f6de5a, 20px 16px #f6de5a,
    /* body*/
    4px 18px #f6de5a, 6px 18px #f6de5a, 8px 18px #f6de5a, 10px 18px #f6de5a, 12px 18px #f6de5a, 14px 18px #f6de5a, 16px 18px #f6de5a, 18px 18px #f6de5a, 20px 18px #f6de5a,
    6px 20px #f6de5a, 8px 20px #f6de5a, 10px 20px #f6de5a, 12px 20px #f6de5a, 14px 20px #f6de5a, 16px 20px #f6de5a, 18px 20px #f6de5a,
    8px 22px #f6de5a, 10px 22px #f6de5a, 12px 22px #f6de5a, 14px 22px #f6de5a, 16px 22px #f6de5a
  }
  .beret.b{ box-shadow:
    10px 4px #6a4a2c, 12px 4px #6a4a2c, 14px 4px #6a4a2c,
    8px 6px #6a4a2c, 16px 6px #6a4a2c
  }
  .earL.b{ box-shadow: 4px 8px #6a4a2c, 6px 8px #6a4a2c }
  .earR.b{ box-shadow: 18px 8px #6a4a2c, 20px 8px #6a4a2c }
  .eyes.b{ box-shadow: 10px 14px #6a4a2c, 16px 14px #6a4a2c }
  .nose.b{ box-shadow: 13px 16px #6a4a2c }
  .belly.p{ box-shadow: 10px 20px #ffcc66, 12px 20px #ffcc66, 14px 20px #ffcc66 }

  /* gentle float animation */
  @keyframes floaty {
    0%{ transform: translate(-50%,-50%) translateY(0) }
    50%{ transform: translate(-50%,-50%) translateY(-6px) }
    100%{ transform: translate(-50%,-50%) translateY(0) }
  }

  /* bezel and UI */
  .bezel{
    width:100%; padding:14px; background:linear-gradient(180deg,#0d1f66,#08133a);
    border:8px solid var(--maze); outline:4px solid #041034; border-radius:6px;
    box-shadow:0 0 0 6px #000, 0 12px 0 0 #0006, 0 20px 40px rgba(0,0,0,.7);
    position:relative; z-index:1;
  }
  h1{margin:0 0 6px; font-size:clamp(18px,5.5vw,28px); letter-spacing:1px; color:var(--accent); text-shadow:0 0 8px rgba(255,235,0,.35),0 0 2px #000; word-break:break-word}
  .subtitle{color:var(--muted); font-size:clamp(10px,3.3vw,12px); line-height:1.6}

  /* timer board */
  .board{margin-top:10px; display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:10px}
  .cell{background:#0a1340; border:4px solid var(--maze); outline:2px solid #020824; border-radius:4px; padding:12px 8px; box-shadow:inset 0 0 0 4px #020b2c}
  .num{font-variant-numeric:tabular-nums; font-size:clamp(22px,8.5vw,42px); line-height:1; color:#fff; text-shadow:0 0 6px rgba(122,160,255,.45)}
  .label{margin-top:6px; color:var(--accent-2); font-size:clamp(9px,2.8vw,10px); letter-spacing:.08em}

  /* pellet progress */
  .progress{margin:12px 0 4px; display:grid; grid-template-columns:repeat(24,1fr); gap:6px}
  .pellet{width:100%; aspect-ratio:1; background:#09123b; border:3px solid var(--maze); outline:2px solid #020824; border-radius:2px; box-shadow:inset 0 0 0 3px #020b2c}
  .pellet.filled{background:var(--accent); border-color:#cdbd00; box-shadow:0 0 8px rgba(255,235,0,.55), inset 0 0 0 3px #473f00}

  .legend{margin-top:6px; display:flex; justify-content:center; gap:12px; flex-wrap:wrap; font-size:10px; color:var(--muted)}
  .dot{display:inline-block; width:10px; height:10px; background:var(--accent); margin-right:6px; vertical-align:-1px; box-shadow:0 0 6px rgba(255,235,0,.55)}

  /* controls */
  .controls{margin-top:12px; display:grid; grid-template-columns:1fr; gap:10px; justify-items:center}
  .row{display:flex; gap:10px; width:100%; justify-content:center; flex-wrap:wrap}
  input,button{
    font:16px/1 "Press Start 2P", system-ui, -apple-system, Segoe UI, Roboto, Arial, monospace;
    color:var(--text); background:var(--tile); border:4px solid var(--maze); outline:2px solid #020824; padding:12px 14px; border-radius:4px;
  }
  input[type="datetime-local"]{min-width:260px; width:min(420px,90vw)}
  input[type="text"]{width:min(420px,90vw)}
  button{cursor:pointer; background:var(--accent-2); color:#00121c; min-width:140px}
  .secondary{background:#14235e; color:#cfe4ff}
  footer{margin-top:6px; color:var(--muted); font-size:10px}

  /* small phones */
  @media (max-width:420px){
    .board{grid-template-columns:repeat(2,minmax(0,1fr))}
    .progress{grid-template-columns:repeat(16,1fr); gap:5px}
    .pellet{outline-width:1px; border-width:2px}
    button{min-width:44vw}
  }
</style>
</head>
<body>
  <main class="wrap" id="canvas">
    <!-- decorative tiny ‚ÄúPurin‚Äù sprites will be injected around here -->
    <div class="bezel">
      <h1 id="title">COUNTYDOWN</h1>
      <div class="subtitle" id="subtitle">Pick a time below.</div>

      <!-- pellets -->
      <div class="progress" id="progress" aria-hidden="true"></div>

      <!-- timer -->
      <section>
        <div class="board" role="timer" aria-live="polite" aria-atomic="true">
          <div class="cell"><div class="num" id="d">0</div><div class="label">DAYS</div></div>
          <div class="cell"><div class="num" id="h">00</div><div class="label">HOURS</div></div>
          <div class="cell"><div class="num" id="m">00</div><div class="label">MIN</div></div>
          <div class="cell"><div class="num" id="s">00</div><div class="label">SEC</div></div>
        </div>

        <div class="legend"><span><span class="dot"></span>progress</span></div>

        <div class="controls">
          <input id="when" type="datetime-local" />
          <input id="label" type="text" placeholder="Event (e.g., LEVEL UP)" />
          <div class="row">
            <button id="start">START</button>
            <button id="reset" class="secondary">RESET</button>
          </div>
        </div>
      </section>

      <footer id="footer"></footer>
    </div>
  </main>

<script>
  // helpers
  const $ = (id) => document.getElementById(id);
  const pad = (n) => String(n).padStart(2,'0');
  const params = new URLSearchParams(location.search);

  const initialISO = params.get('until');
  const initialTitle = params.get('title') || 'COUNTYDOWN';

  function defaultTarget(){ const now=new Date(); return new Date(now.getFullYear()+1,0,1,0,0,0); }

  let target = initialISO ? new Date(initialISO) : defaultTarget();
  let startTime = new Date();
  let tickId = null;

  // pellets
  const progressBar = $('progress');
  const PELLETS = getComputedStyle(progressBar).gridTemplateColumns.split(' ').length || 24;
  for (let i=0;i<PELLETS;i++){ const p=document.createElement('div'); p.className='pellet'; progressBar.appendChild(p); }

  // init UI
  $('title').textContent = decodeURIComponent(initialTitle);
  $('label').value = initialTitle !== 'COUNTYDOWN' ? decodeURIComponent(initialTitle) : '';
  setPickerFromDate(target);

  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Local time';
  $('footer').textContent = `Now: ${new Date().toLocaleString()} ‚Äî ${tz}`;

  function diffParts(ms){
    if (ms < 0) ms = 0;
    const s = Math.floor(ms / 1000);
    return { days:Math.floor(s/86400), hours:Math.floor((s%86400)/3600), minutes:Math.floor((s%3600)/60), seconds:s%60 };
  }

  function setPickerFromDate(date){
    const z = new Date(date.getTime() - date.getTimezoneOffset()*60000).toISOString().slice(0,16);
    $('when').value = z;
  }
  function readPicker(){ const v=$('when').value; return v ? new Date(v) : null; }

  function updatePellets(fracRemaining){
    const pellets = progressBar.children;
    const filled = Math.round(PELLETS * fracRemaining);
    for (let i=0;i<PELLETS;i++){ pellets[i].classList.toggle('filled', i < filled); }
  }

  function update(){
    const now = new Date();
    const remaining = target - now;
    const {days, hours, minutes, seconds} = diffParts(remaining);

    $('d').textContent = days;
    $('h').textContent = pad(hours);
    $('m').textContent = pad(minutes);
    $('s').textContent = pad(seconds);

    const span = Math.max(1, target - startTime);
    const elapsed = Math.min(Math.max(0, now - startTime), span);
    const fracRemaining = 1 - (elapsed / span);
    updatePellets(fracRemaining);

    if (remaining <= 0){ clearInterval(tickId); tickId = null; finish(); }
  }

  function startTimer(){
    clearInterval(tickId);
    tickId = setInterval(update, 250);
    update();
    $('subtitle').textContent = `Counting down to ${target.toLocaleString()} (${tz})`;
    document.title = ($('label').value?.trim() || 'COUNTYDOWN') + ' ‚Äì running';
  }

  function finish(){
    $('subtitle').textContent = `LEVEL COMPLETE! (${target.toLocaleString()})`;
    document.title = 'LEVEL COMPLETE! üéâ';
    updatePellets(0);
  }

  $('start').addEventListener('click', ()=>{
    const picked = readPicker();
    if (!picked) return alert('Pick a date/time first!');
    target = picked; startTime = new Date();
    const title = $('label').value?.trim();
    $('title').textContent = title || 'COUNTYDOWN';
    startTimer();
  });

  $('reset').addEventListener('click', ()=>{
    target = defaultTarget(); startTime = new Date();
    setPickerFromDate(target);
    $('label').value = '';
    $('title').textContent = 'COUNTYDOWN';
    $('subtitle').textContent = 'Pick a time below.';
    startTimer();
  });

  // ----- Tiny Pompompurin-ish sprites -----
  const canvas = document.getElementById('canvas');
  const isSmall = window.matchMedia('(max-width: 480px)').matches;
  const SPRITES = isSmall ? 10 : 18;

  function makeSprite(xPct, yPct, delay){
    const s = document.createElement('div');
    s.className = 'sprite';
    s.style.left = xPct + '%';
    s.style.top = yPct + '%';
    s.style.animation = `floaty ${4 + Math.random()*3}s ease-in-out ${delay}s infinite`;
    s.setAttribute('aria-hidden','true');

    const pixBody = document.createElement('div');
    pixBody.className = 'pix';
    // layers
    const body = document.createElement('i'); body.className = 'body y';
    const beret = document.createElement('i'); beret.className = 'beret b';
    const earL = document.createElement('i'); earL.className = 'earL b';
    const earR = document.createElement('i'); earR.className = 'earR b';
    const eyes = document.createElement('i'); eyes.className = 'eyes b';
    const nose = document.createElement('i'); nose.className = 'nose b';
    const belly = document.createElement('i'); belly.className = 'belly p';

    pixBody.append(body, beret, earL, earR, eyes, nose, belly);
    s.appendChild(pixBody);
    canvas.appendChild(s);
  }

  function scatterSprites(){
    // place around edges and random spots
    for(let i=0;i<SPRITES;i++){
      const ring = i % 4;
      let x = 5 + Math.random()*90;
      let y = 5 + Math.random()*90;
      if(ring===0) y = 5 + Math.random()*15;
      if(ring===1) y = 85 + Math.random()*10;
      if(ring===2) x = 5 + Math.random()*15;
      if(ring===3) x = 85 + Math.random()*10;
      makeSprite(x, y, Math.random()*2);
    }
  }
  scatterSprites();

  // auto-start if URL had ?until=
  if (initialISO){ startTimer(); } else { update(); }
</script>
</body>
</html>
