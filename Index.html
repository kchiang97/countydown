<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Countdown</title>
  <meta name="description" content="A minimal, shareable countdown timer." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚è≥</text></svg>">
  <style>
    :root{
      --fg:#0b1220; --muted:#5b677a; --card:#ffffff;
      --bg: radial-gradient(1200px 800px at 20% 10%, #eef2ff 0%, #f7f7fb 35%, #ffffff 70%);
      --accent:#4f46e5; --accent-2:#22c55e;
      --shadow: 0 10px 30px rgba(0,0,0,.10), 0 2px 10px rgba(0,0,0,.05);
      --border: rgba(0,0,0,.08);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --fg:#e6e9ef; --muted:#9aa4b2; --card:#111827;
        --bg: radial-gradient(1200px 800px at 20% 10%, #0b1220 0%, #0d1326 40%, #0b1120 80%);
        --accent:#8b93ff; --accent-2:#4ade80;
        --shadow: 0 10px 30px rgba(0,0,0,.35), 0 2px 10px rgba(0,0,0,.25);
        --border: rgba(255,255,255,.12);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--fg); background:var(--bg);
      display:grid; place-items:center; padding:24px;
    }
    .wrap{width:min(900px,92vw); display:flex; flex-direction:column; gap:20px; align-items:center; text-align:center}
    h1{margin:0; font-size:clamp(28px,4vw,48px); letter-spacing:.4px}
    .subtitle{color:var(--muted); font-size:clamp(12px,2vw,14px)}
    .card{width:100%; background:rgba(255,255,255,.6); backdrop-filter:saturate(140%) blur(6px);
          border:1px solid var(--border); border-radius:20px; box-shadow:var(--shadow); padding:20px}
    @media (prefers-color-scheme: dark){ .card{background:rgba(17,24,39,.6)} }
    .grid{display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:14px}
    .unit{padding:18px 12px; border-radius:16px; background:rgba(255,255,255,.5); border:1px solid var(--border)}
    @media (prefers-color-scheme: dark){ .unit{background:rgba(17,24,39,.5)} }
    .num{font-variant-numeric:tabular-nums; font-size:clamp(28px,6vw,56px); line-height:1; font-weight:700}
    .label{margin-top:6px; color:var(--muted); text-transform:uppercase; letter-spacing:.12em; font-size:12px}
    .controls{display:flex; flex-wrap:wrap; gap:10px; justify-content:center; align-items:center; margin-top:10px}
    input,button,select{font:inherit; color:inherit; background:rgba(255,255,255,.6); border:1px solid var(--border); padding:10px 12px; border-radius:12px; outline:none}
    @media (prefers-color-scheme: dark){ input,button,select{background:rgba(17,24,39,.6)} }
    input[type="datetime-local"]{min-width:260px}
    button{cursor:pointer; border:0; background:linear-gradient(180deg, var(--accent), rgba(0,0,0,.12)); color:#fff; font-weight:600; box-shadow:var(--shadow)}
    button.secondary{background:transparent; color:var(--accent); border:1px solid rgba(79,70,229,.5); box-shadow:none}
    .share,.notice{margin-top:6px; font-size:12px; color:var(--muted)}
    footer{margin-top:6px; color:var(--muted); font-size:12px}
    .ring{width:min(160px,30vw); height:min(160px,30vw); aspect-ratio:1; position:relative; margin:6px auto 0}
    .ring svg{position:absolute; inset:0}
    .ring .center{position:absolute; inset:0; display:grid; place-items:center; font-size:clamp(12px,2.2vw,15px); color:var(--muted)}
    a{color:var(--accent)}
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <h1 id="title">Countdown</h1>
      <div class="subtitle" id="subtitle">Set a target below or share a link.</div>
      <div class="ring" aria-hidden="true">
        <svg viewBox="0 0 120 120">
          <circle cx="60" cy="60" r="52" stroke="rgba(0,0,0,.12)" stroke-width="10" fill="none" />
          <circle id="progress" cx="60" cy="60" r="52" stroke="var(--accent-2)" stroke-width="10" fill="none" stroke-linecap="round" pathLength="1" transform="rotate(-90 60 60)" />
        </svg>
        <div class="center" id="progressText"></div>
      </div>
    </header>

    <section class="card">
      <div class="grid" role="timer" aria-live="polite" aria-atomic="true">
        <div class="unit"><div class="num" id="d">0</div><div class="label">Days</div></div>
        <div class="unit"><div class="num" id="h">00</div><div class="label">Hours</div></div>
        <div class="unit"><div class="num" id="m">00</div><div class="label">Minutes</div></div>
        <div class="unit"><div class="num" id="s">00</div><div class="label">Seconds</div></div>
      </div>

      <div class="controls">
        <input id="when" type="datetime-local" />
        <input id="label" type="text" placeholder="Event name (e.g., New Year)" />
        <select id="finishfx" aria-label="Finish effect">
          <option value="confetti">Confetti on finish</option>
          <option value="none">No effect</option>
        </select>
        <button id="start">Start</button>
        <button id="copy" class="secondary">Copy share link</button>
        <button id="reset" class="secondary">Reset</button>
      </div>
      <div class="share" id="shareNote"></div>
      <div class="notice" id="tzNote"></div>
    </section>

    <footer id="footer"></footer>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    const pad = (n) => String(n).padStart(2,'0');

    // URL params work on GitHub Pages (HTTPS), e.g. ?until=2025-12-31T23:59:59Z&title=New%20Year&fx=confetti
    const params = new URLSearchParams(location.search);
    const initialISO = params.get('until');
    const initialTitle = params.get('title') || 'Countdown';
    const initialFx = params.get('fx') || 'confetti';
    const accent = params.get('accent'); if (accent) document.documentElement.style.setProperty('--accent', accent);

    function defaultTarget(){
      const now = new Date();
      return new Date(now.getFullYear()+1, 0, 1, 0, 0, 0);
    }

    let target = initialISO ? new Date(initialISO) : defaultTarget();
    let startTime = new Date();
    let tickId = null;

    $('title').textContent = decodeURIComponent(initialTitle);
    $('label').value = initialTitle !== 'Countdown' ? decodeURIComponent(initialTitle) : '';
    $('finishfx').value = initialFx;
    setPickerFromDate(target);

    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Local time';
    $('tzNote').textContent = `Target time shown in your timezone: ${tz}.`;
    $('footer').textContent = `Now: ${new Date().toLocaleString()} ‚Äî ${tz}`;

    const progressEl = $('progress');
    const progressText = $('progressText');
    progressEl.style.strokeDasharray = '1 1';

    function diffParts(ms){
      if (ms < 0) ms = 0;
      const s = Math.floor(ms / 1000);
      return {
        days: Math.floor(s / 86400),
        hours: Math.floor((s % 86400) / 3600),
        minutes: Math.floor((s % 3600) / 60),
        seconds: s % 60
      };
    }

    function update(){
      const now = new Date();
      const remaining = target - now;
      const {days, hours, minutes, seconds} = diffParts(remaining);

      $('d').textContent = days;
      $('h').textContent = pad(hours);
      $('m').textContent = pad(minutes);
      $('s').textContent = pad(seconds);

      const span = Math.max(1, target - startTime);
      const elapsed = Math.min(Math.max(0, now - startTime), span);
      const frac = elapsed / span;
      progressEl.style.strokeDashoffset = 1 - frac;
      progressText.textContent = Math.round((1 - frac) * 100) + '%';

      if (remaining <= 0){
        clearInterval(tickId); tickId = null;
        finish();
      }
    }

    function startTimer(){
      clearInterval(tickId);
      tickId = setInterval(update, 250);
      update();
      $('subtitle').textContent = `Counting down to ${target.toLocaleString()} (${tz})`;
    }

    function setPickerFromDate(date){
      const z = new Date(date.getTime() - date.getTimezoneOffset()*60000)
                .toISOString().slice(0,16);
      $('when').value = z;
    }

    function readPicker(){
      const v = $('when').value;
      return v ? new Date(v) : null; // local time
    }

    function pageShareLink(){
      const title = $('label').value?.trim() || 'Countdown';
      const fx = $('finishfx').value || 'confetti';
      const iso = target.toISOString();
      const url = new URL(location.href);  // works fine on GitHub Pages paths
      url.searchParams.set('until', iso);
      url.searchParams.set('title', title);
      url.searchParams.set('fx', fx);
      return url.toString();
    }

    function finish(){
      $('subtitle').textContent = `It's time! (${target.toLocaleString()})`;
      if ($('finishfx').value === 'confetti' || params.get('fx') === 'confetti') confetti();
      document.title = 'Time\'s up! üéâ';
      progressEl.style.strokeDashoffset = 0;
      progressText.textContent = '0%';
    }

    function confetti(){
      const N = 120;
      for (let i=0;i<N;i++){
        const p = document.createElement('div');
        const size = 6 + Math.random()*6;
        Object.assign(p.style,{
          position:'fixed', left:(Math.random()*100)+'vw', top:'-10px',
          width:size+'px', height:size+'px',
          background: Math.random()>.5 ? 'var(--accent)' : 'var(--accent-2)',
          transform:`rotate(${Math.random()*360}deg)`,
          borderRadius: Math.random()>.5 ? '2px' : '50%',
          pointerEvents:'none', zIndex:9999
        });
        document.body.appendChild(p);
        const duration = 3000 + Math.random()*2500;
        p.animate([
          {transform:`translateY(0) rotate(0deg)`, opacity:1},
          {transform:`translateY(100vh) rotate(${360+Math.random()*720}deg)`, opacity:0.9}
        ], {duration, easing:'cubic-bezier(.23,1,.32,1)'}).onfinish = ()=>p.remove();
      }
    }

    $('start').addEventListener('click', ()=>{
      const picked = readPicker();
      if (!picked) return alert('Pick a date/time first!');
      target = picked; startTime = new Date();
      const title = $('label').value?.trim();
      $('title').textContent = title || 'Countdown';
      document.title = title ? `${title} ‚Äì Countdown` : 'Countdown';
      $('shareNote').innerHTML = `Shareable link created. <a href="${pageShareLink()}">Open in a new tab</a> or click "Copy".`;
      startTimer();
    });

    $('copy').addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(pageShareLink());
        $('shareNote').textContent = 'Link copied to clipboard!';
      }catch{
        $('shareNote').textContent = 'Could not copy. Long-press the address bar to copy the URL.';
      }
    });

    $('reset').addEventListener('click', ()=>{
      target = defaultTarget(); startTime = new Date();
      setPickerFromDate(target);
      $('label').value = ''; $('title').textContent = 'Countdown';
      $('finishfx').value = 'confetti';
      history.replaceState({}, '', location.pathname);
      $('shareNote').textContent = '';
      startTimer();
    });

    if (initialISO){ startTimer(); } else { update(); }
  </script>
</body>
</html>
